{% extends "admin_base.html" %}
{% block title %}Pharmacy | MediCore{% endblock %}
{% block content %}
<section class="page-head">
  <h1 class="display-md">Pharmacy Inventory</h1>
</section>

<section class="grid-2">
  <article class="card">
    <h3>Add Medicine</h3>
    <form method="post" action="{{ url_for('pharmacy.add_medicine') }}" class="form-grid">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input class="form-input" name="name" required>
      </div>
      <div class="form-group">
        <label class="form-label">Quantity</label>
        <input class="form-input" type="number" name="quantity" required>
      </div>
      <div class="form-group">
        <label class="form-label">Price</label>
        <input class="form-input" type="number" step="0.01" name="price" required>
      </div>
      <div class="form-group">
        <label class="form-label">Expiry Date</label>
        <input class="form-input" type="date" name="expiry_date">
      </div>
      <button class="btn btn-primary" type="submit">Save Medicine</button>
    </form>
  </article>

  <article class="card">
    <h3>Write Prescription</h3>
    <form method="post" action="{{ url_for('pharmacy.create_prescription') }}" class="form-grid">
      <div class="form-group">
        <label class="form-label">Appointment</label>
        <select class="form-input" name="appt_id" required>
          <option value="">Select appointment</option>
          {% for a in appointments %}
          <option value="{{ a.appt_id }}">#{{ a.appt_id }} - {{ a.patient_name }} (Dr. {{ a.doctor_name }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Medicine</label>
        <select class="form-input" name="medicine_id" required>
          {% for m in medicines %}
          <option value="{{ m.medicine_id }}">{{ m.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Dosage</label>
        <input class="form-input" name="dosage" placeholder="1 tablet after meals" required>
      </div>
      <div class="form-group">
        <label class="form-label">Duration</label>
        <input class="form-input" name="duration" placeholder="5 days" required>
      </div>
      <div class="form-group full">
        <label class="form-label">Instructions</label>
        <textarea class="form-input" name="instructions"></textarea>
      </div>
      <button class="btn btn-primary" type="submit">Create Prescription</button>
    </form>
  </article>
</section>

<section class="card">
  <h3>Current Stock</h3>
  <table class="data-table">
    <thead><tr><th>Medicine</th><th>Qty</th><th>Price</th><th>Expiry</th><th>Actions</th></tr></thead>
    <tbody>
      {% for m in medicines %}
      <tr>
        <td>{{ m.name }} {% if m.low_stock %}<span class="status-badge status-pending">Low stock</span>{% endif %}</td>
        <td>{{ m.quantity }}</td>
        <td>Rs. {{ "%.2f"|format(m.price) }}</td>
        <td>{{ m.expiry_date or '-' }}</td>
        <td class="row-actions">
          <form method="post" action="{{ url_for('pharmacy.edit_medicine', medicine_id=m.medicine_id) }}" class="row">
            <input class="form-input small" type="number" name="quantity" value="{{ m.quantity }}">
            <input class="form-input small" type="number" step="0.01" name="price" value="{{ m.price }}">
            <input class="form-input small" type="date" name="expiry_date" value="{{ m.expiry_date }}">
            <button class="btn btn-ghost" type="submit">Update</button>
          </form>
          <form method="post" action="{{ url_for('pharmacy.delete_medicine', medicine_id=m.medicine_id) }}" onsubmit="return confirm('Deactivate this medicine?')">
            <button class="btn btn-danger" type="submit">Delete</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="5" class="text-muted">No medicines yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
